generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Client {
  id        String   @id @default(uuid())
  companyId String
  name      String
  email     String?
  address   String?
  city      String?
  zipCode   String?
  country   String   @default("FR")
  tvaNumber String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt // <-- Ajout de @updatedAt

  // CORRECTION : Renommé "Company" en "company" (minuscule)
  company   Company  @relation(fields: [companyId], references: [id])
  invoices  Invoice[] // Optionnel : Renommé en "invoices" par convention
}

model Company {
  id               String   @id @default(uuid())
  name             String
  email            String?
  address          String?
  city             String?
  zipCode          String?
  country          String   @default("FR")
  siret            String?
  tvaNumber        String?
  logoUrl          String?
  stripeAccountId  String?
  invoicePrefix    String   @default("FAC-")
  nextInvoiceNumber Int     @default(1)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations (minuscules plurielles recommandées)
  clients          Client[]
  expenses         Expense[]
  invoices         Invoice[]
  products         Product[]
  users            User[]    // C'était déjà bon ici !
}

model Expense {
  id          String   @id @default(uuid()) // <-- Ajout de @default(uuid())
  companyId   String
  description String
  amount      Int
  date        DateTime @default(now())
  category    String?
  receiptUrl  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt // <-- Ajout de @updatedAt

  // CORRECTION : Renommé "Company" en "company"
  company     Company  @relation(fields: [companyId], references: [id])
}

model Invoice {
  id                String        @id @default(uuid()) // <-- Ajout de @default(uuid())
  companyId         String
  clientId          String
  number            String
  status            InvoiceStatus @default(DRAFT)
  date              DateTime      @default(now())
  dueDate           DateTime?
  subtotal          Int
  tvaAmount         Int
  total             Int
  pdfUrl            String?
  stripePaymentLink String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt // <-- Ajout de @updatedAt

  // Relations
  client            Client        @relation(fields: [clientId], references: [id])
  // CORRECTION : Renommé "Company" en "company"
  company           Company       @relation(fields: [companyId], references: [id])
  items             InvoiceItem[] // C'était déjà bon ici !

  @@unique([companyId, number])
}

model InvoiceItem {
  id          String   @id @default(uuid()) // <-- Ajout de @default(uuid())
  invoiceId   String
  description String
  quantity    Decimal  @default(1)
  unitPrice   Int
  tvaRate     Decimal
  total       Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt // <-- Ajout de @updatedAt

  // CORRECTION : Renommé "Invoice" en "invoice"
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}

model Product {
  id          String   @id @default(uuid()) // <-- Ajout de @default(uuid())
  companyId   String
  name        String
  description String?
  price       Int
  tvaRate     Decimal  @default(20.0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt // <-- Ajout de @updatedAt

  // CORRECTION : Renommé "Company" en "company"
  company     Company  @relation(fields: [companyId], references: [id])
}

model User {
  id         String   @id @default(uuid()) // <-- Ajout de @default(uuid())
  email      String   @unique
  supabaseId String   @unique
  firstName  String?
  lastName   String?
  role       UserRole @default(OWNER)
  companyId  String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt // <-- Ajout de @updatedAt

  // CORRECTION : Renommé "Company" en "company"
  company    Company  @relation(fields: [companyId], references: [id])
}

enum InvoiceStatus {
  DRAFT
  FINALIZED
  SENT
  PAID
  OVERDUE
  CANCELLED
}

enum PaymentMethod {
  TRANSFER
  CARD
  CASH
  CHECK
  OTHER
}

enum UserRole {
  OWNER
  ADMIN
  MEMBER
}
